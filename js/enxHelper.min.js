!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof module&&"object"==typeof module.exports?module.exports=t(require("jquery")):e.enxHelper=t(e.jQuery)}(this,function(c){var e=new function(){var E=this;this.GlobalVar=new function(){this.XMLTAG="<\\?xml.*\\?>",this.ExceptionNode="#text",this.IllegalTagEnd="/>",this.LawfulTagEnd="></parameter>",this.LinkTag="link>",this.LinkTagReplace="linkC>",this.UserDefineField=[],this.SpaceCount=2,this.FormatTpl=new function(){this.Paratemter="<parameter{0}/>",this.Link="<link>{0}</link>",this.CDATA="<![CDATA[{0}]]>"},this.ElemntIndex=new function(){this.Link=1,this.Ne=1,this.Board=1,this.SubBoard=1,this.Port=1,this.Tester=1,this.Dev=1,this.Atm=1,this.Eth=1,this.Sdh=1,this.Sftp=1,this.Agent=1,this.VM=1,this.Network=1},this.DeaultElemntIndex=new function(){this.Link=1,this.Ne=1,this.Board=1,this.SubBoard=1,this.Port=1,this.Tester=1,this.Dev=1,this.Atm=1,this.Eth=1,this.Sdh=1,this.Sftp=1,this.Agent=1,this.VM=1,this.Network=1}},this.Field={ID:"_id",BigType:"BigType",ParentGID:"ParentGID",IsTopDevice:"IsTopDevice",Name:"Name"},this.SpecialField={IP:"ip"},this.ModelType={Env:"Env",Ne:"Ne",Board:"Board",SubBoard:"SubBoard",Port:"Port",Link:"Link",Topolimit:"Topolimit",Tester:"Tester",Dev:"Dev",Atm:"Atm",Eth:"Eth",Sdh:"Sdh",Network:"Network",Sftp:"Sftp",Agent:"Agent",VM:"VM",Other:"Other"},this.ModelTypeOfTopDevice=[this.ModelType.Ne,this.ModelType.Atm,this.ModelType.Tester,this.ModelType.Dev,this.ModelType.Eth,this.ModelType.Sdh,this.ModelType.Network,this.ModelType.Sftp,this.ModelType.Agent],this.ResetMaxIndex=function(e,t){var n=t.match(new RegExp("0|[1-9]\\d*","gm"));n&&0<n.length&&this.GlobalVar.ElemntIndex[e]<=parseInt(n[n.length-1])&&(this.GlobalVar.ElemntIndex[e]=parseInt(n[n.length-1])+1)},this.PreDealEnxContent=function(e){return e.replace(new RegExp(this.GlobalVar.XMLTAG,"gm"),"").replace(new RegExp(E.GlobalVar.IllegalTagEnd,"gm"),E.GlobalVar.LawfulTagEnd).replace(new RegExp(E.GlobalVar.LinkTag,"gm"),E.GlobalVar.LinkTagReplace)},this.EnxToLstJson=function(e){var o=this;this.GlobalVar.ElemntIndex=this.GlobalVar.DeaultElemntIndex;var s=[];if(!e)return s;var t=this.PreDealEnxContent(e),n=c(t)[0],l={};l[T.RootNodeAttr]=E.GetNodeAttr(n);var r=E.GetChildNode(n);return c.each(r,function(e,t){switch(t.tagName){case T.NodeName.ENXFILE_NODE_PARAMETERS:var n=E.ParameterNodeToJson(t);l=d.CombineJson(n,l),s.push(l);break;case T.NodeName.ENXFILE_NODE_DEVICES:var r=E.GetChildNode(t);c(r).each(function(e,t){var n=E.DeviceNodeToJson(t,l,!0);s=s.concat(n)});break;case T.NodeName.ENXFILE_NODE_LINKS:var i=E.GetChildNode(t);c(i).each(function(e,t){var n=E.LinkNodeToJson(t);n&&n.objname&&n.objname.value&&(n[E.Field.ParentGID]=d.GetStrValue(l,E.Field.ID),s.push(n),o.ResetMaxIndex(E.ModelType.Link,n.objname.value))});break;case T.NodeName.ENXFILE_NODE_TOPOLIMIT:var a={};a[E.Field.BigType]=E.ModelType.Topolimit,a[E.Field.ParentGID]=d.GetStrValue(l,E.Field.ID),a[E.Field.Name]=E.MatchTopLimit(c.trim(t.innerHTML)),a[E.Field.ID]=E.CreateNewGuid(),s.push(a)}}),s},this.LstJsonToEnx=function(e){if(!e||0==e.length)return"";var t=c(T.XMLTAG.LOGIC_ENVIRONMENT),n=d.GetJsonByKey(e,E.Field.BigType,E.ModelType.Env);d.IsJsonObj(n)&&!d.IsEmptyJson(n)&&n||(n=E.ParameterNodeToJson(null));var r=n[T.RootNodeAttr];for(var i in r)t.attr(i,d.GetStrValue(r,i));var a=c(T.XMLTAG.PARAMETERSTAG);a[0].innerText=E.XmlGetParameter(n,!0),t.append(a),E.XMLJsonToNode(n,t,e);var o=c(T.XMLTAG.LINKS),s=d.FilterListByValues(e,E.Field.BigType,[E.ModelType.Link]),l="";c.each(s,function(e,t){l+=E.Format(E.GlobalVar.FormatTpl.Link,E.XmlGetParameter(t))}),o[0].innerText=l,t.append(o);var h=d.GetJsonByKey(e,E.Field.BigType,E.ModelType.Topolimit),u=c(T.XMLTAG.TOPOLIMIT);return u[0].innerText=E.Format(E.GlobalVar.FormatTpl.CDATA,h[E.Field.Name]||""),t.append(u),t[0].outerHTML},this.XmlGetParameter=function(e,t){0==this.GlobalVar.UserDefineField.length&&(this.GlobalVar.UserDefineField=d.GetJsonAllValue(E.Field),this.GlobalVar.UserDefineField.push(T.RootNodeAttr));var n="";for(var r in e)if(this.GlobalVar.UserDefineField.indexOf(r)<0){var i=e[r],a="";for(var o in i){a+=" "+o+'="'+this.DealSpecialSingal(i[o])+'"'}n+=E.Format(E.GlobalVar.FormatTpl.Paratemter,a)}return n},this.DealSpecialSingal=function(e){return null!=e&&null!=e&&e&&(-1<e.indexOf('"')&&(e=e.replace(new RegExp('"',"gm"),"★")),-1<e.indexOf("&")&&(e=e.replace(new RegExp("&","gm"),"♣")),-1<e.indexOf("<")&&(e=e.replace(new RegExp("<","gm"),"◀")),-1<e.indexOf(">")&&(e=e.replace(new RegExp(">","gm"),"▶"))),e},this.XMLJsonToNode=function(e,t,a){var n=d.GetStrValue(e,E.Field.ID),r=[];if((r=e.BigType==E.ModelType.Env?d.FilterListByValues(a,E.Field.IsTopDevice,[T.BoolStr.Yes]):d.FilterListByValues(a,E.Field.ParentGID,[n]))&&0<r.length){var o=c(T.XMLTAG.DEVICES);c.each(r,function(e,t){var n=c(T.XMLTAG.DEVICE),r=c(T.XMLTAG.PARAMETERSTAG),i=E.XmlGetParameter(t);r[0].innerText=i,n.append(r),E.XMLJsonToNode(t,n,a),o.append(n)}),t.append(o)}},this.GetUserDefineField=function(){},this.LinkNodeToJson=function(e){var r={},t=E.GetChildNode(e);return c.each(t,function(e,t){var n=c(t).attr(T.AttrName.ENXFILE_ATTR_NAME);n&&(r[E.Field.BigType]=E.ModelType.Link,r[n]=E.GetNodeAttr(t))}),this.NodeAttachFieldId(r),r},this.NodeAttachFieldId=function(e){var t=d.GetJsonValue(e,T.AttrName.ENXFILE_ATTR_GUID),n=d.GetStrValue(t,T.AttrName.ENXFILE_ATTR_VALUE),r=n||E.CreateNewGuid();e[E.Field.ID]=r},this.ParameterNodeToJson=function(e){var r={};r[E.Field.BigType]=E.ModelType.Env;var t=E.GetChildNode(e);return c.each(t,function(e,t){var n=c(t).attr(T.AttrName.ENXFILE_ATTR_NAME);r[n]=E.GetNodeAttr(t)}),this.NodeAttachFieldId(r),r},this.DeviceNodeToJson=function(e,t,n){var r=[],i={};i[E.Field.ParentGID]=t[E.Field.ID]||"",i[E.Field.IsTopDevice]=n?T.BoolStr.Yes:T.BoolStr.No;var a=[],o=E.GetChildNode(e);return c.each(o,function(e,t){var n=t.tagName,r=E.GetChildNode(t);switch(n){case T.NodeName.ENXFILE_NODE_DEVICES:c.each(r,function(e,t){var n=E.DeviceNodeToJson(t,i);a=a.concat(n)});break;case T.NodeName.ENXFILE_NODE_PARAMETERS:if(c.each(r,function(e,t){var n=c(t).attr(T.AttrName.ENXFILE_ATTR_NAME);if(n==T.AttrName.ENXFILE_ATTR_CLASS){var r=c(t).attr(T.AttrName.ENXFILE_ATTR_VALUE);i[E.Field.BigType]=E.GetDeviceType(r)}i[n]=E.GetNodeAttr(t)}),"ne1_board1_subboard1_port1"==i.objname.value);E.NodeAttachFieldId(i)}}),i.objname&&(this.ResetMaxIndex(i[E.Field.BigType],i.objname.value),r.push(i),r=r.concat(a)),r},this.MatchTopLimit=function(e){return e.replace("\x3c!--[CDATA[","").replace("]]--\x3e","")},this.GetDeviceType=function(e){var t="";switch(e){case T.SpecialName.ENXFILE_SPECIAL_TESTERTYPE:t=E.ModelType.Tester;break;case T.SpecialName.ENXFILE_SPECIAL_DEVTYPE:t=E.ModelType.Dev;break;case T.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEATM:t=E.ModelType.Atm;break;case T.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEETH:t=E.ModelType.Eth;break;case T.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPESDH:t=E.ModelType.Sdh;break;default:t=e}return t},this.GetNodeAttr=function(e){var t=e.attributes,n=c.makeArray(t);n.sort(function(e,t){return T.AttrDic[e.name]-T.AttrDic[t.name]});var r={};return c.each(n,function(e,t){r[t.name]=t.value}),r},this.CreateNewGuid=function(){for(var e="",t=1;t<=32;t++){e+=Math.floor(16*Math.random()).toString(16),8!=t&&12!=t&&16!=t&&20!=t||(e+="-")}return e},this.Format=function(n,e){return 1==arguments.length?function(){var e=c.makeArray(arguments);return e.unshift(n),E.Format.apply(this,e)}:(2<arguments.length&&e.constructor!=Array&&(e=c.makeArray(arguments).slice(1)),e.constructor!=Array&&(e=[e]),c.each(e,function(e,t){n=n.replace(new RegExp("\\{"+e+"\\}","g"),t)}),n)},this.GetChildNode=function(e){var n=[];return e&&e.childNodes&&c.each(e.childNodes,function(e,t){t.nodeName!=E.GlobalVar.ExceptionNode&&n.push(t)}),n},this.GetQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},this.AttrParameter=function(e,t){var n={};return n[T.AttrName.ENXFILE_ATTR_NAME]=e,n[T.AttrName.ENXFILE_ATTR_VALUE]=t||"",n}},T=new function(){this.RootNodeAttr="rootNodeAttr",this.NodeName={ENXFILE_NODE_DEVICES:"DEVICES",ENXFILE_NODE_LINKS:"LINKS",ENXFILE_NODE_TOPOLIMIT:"TOPOLIMIT",ENXFILE_NODE_LINK:"LINK",ENXFILE_NODE_DEVICE:"DEVICE",ENXFILE_NODE_PARAMETER:"PARAMETER",ENXFILE_NODE_PARAMETERS:"PARAMETERS"},this.AttrName={ENXFILE_ATTR_NAME:"name",ENXFILE_ATTR_OBJNAME:"objname",ENXFILE_ATTR_VALUE:"value",ENXFILE_ATTR_GROUPSHOW:"groupshow",ENXFILE_ATTR_CLASS:"class",ENXFILE_ATTR_SOURCETOPDEVICENAME:"sourcetopdevicename",ENXFILE_ATTR_TARGETTOPDEVICENAME:"targettopdevicename",ENXFILE_ATTR_SOURCEDEVICEID:"sourcedeviceid",ENXFILE_ATTR_TARGETDEVICEID:"targetdeviceid",ENXFILE_ATTR_GUID:"guid",ENXFILE_ATTR_ROLER:"roler",ENXFILE_ATTR_CLASS:"class",ENXFILE_ATTR_FULLCLASS:"fullclass",ENXFILE_ATTR_POSITION:"position",ENXFILE_ATTR_INTERFACE:"interface"},this.SpecialName={ENXFILE_SPECIAL_TESTERTYPE:"Instru::Tester",ENXFILE_SPECIAL_DEVTYPE:"Instru::Dev",ENXFILE_SPECIAL_UNKOWNTYPEETH:"Instru::Eth::Chassis",ENXFILE_SPECIAL_UNKOWNTYPEATM:"Instru::Atm::Chassis",ENXFILE_SPECIAL_UNKOWNTYPESDH:"Instru::Sdh",ENXFILE_SPECIAL_UNKOWNTYPECONNECT:"Connect"},this.XMLTAG=new function(){this.LOGIC_ENVIRONMENT="<logic_environment></logic_environment>",this.PARAMETERSTAG="<parameters></parameters>",this.DEVICES="<devices></devices>",this.LINKS="<links></links>",this.TOPOLIMIT="<topolimit></topolimit>",this.DEVICE="<device></device>",this.LINK="<link></link>",this.PARAMETER="<parameter/>"},this.AttrDic={name:10,value:11,notnull:12,visible:13,readonly:14,description:15,version:16},this.BoolStr={Yes:"yes",No:"no"},this.NameSeparate="_",this.NamePoint="to",this.ClassSeparate="::"},d=new function(){this.SetJsonByKey=function(e,t,n,r,i){if(e&&0<e.length)for(var a=0;a<e.length;a++){var o=e[a];this.IsContainKey(r,o[t])?o[n]=i[r[o[t]].toString()]:o[n]=i.default}return{}},this.GetJsonByKey=function(e,t,n){var r={};if(e&&0<e.length)for(var i=0;i<e.length;i++){var a=e[i];if(a[t]==n){r=a;break}}return r},this.GetJsonByKeyAndSecondKey=function(e,t,n,r){var i={};if(e&&0<e.length)for(var a=0;a<e.length;a++){var o=e[a];if(o[t][n]==r){i=o;break}}return i},this.GetJsonKeyList=function(e){var t=[];for(var n in e)t.push(e[n]);return t},this.ParseJsonToArr=function(e){var t=[];for(var n in e){var r={Name:n,Value:e[n]};t.push(r)}return t},this.GetJsonAllValue=function(e){var t=[];for(var n in e)t.push(e[n]);return t},this.GetJsonAllKey=function(e){var t=[];for(var n in e)t.push(n);return t},this.CopyJson=function(e){var t={};if(e){var n=c.toJSON(e);t=this.strJsonToJsonObj(n)}return t},this.IsEmptyJson=function(e){var t=!0;if(e)for(var n in e)if(!(t=!1))break;return t},this.IsContainKey=function(e,t){var n=!1;if(e)for(var r in e)if(r==t){n=!0;break}return n},this.ParseArrStrToArrJson=function(e){var n=[];return e&&0<e.length&&c(e).each(function(e,t){n.push(JSON.parse(t))}),n},this.IsArrStrContain=function(e,t){var n=!1;if(e&&0<e.length)for(var r=0;r<e.length;r++){if(e[r]==t){n=!0;break}}return n},this.strJsonToJsonObj=function(e){return new Function("return "+e)()},this.GetListValueByKey=function(e,n){var r=[];return e&&0<e.length&&c(e).each(function(e,t){r.push(t[n])}),r},this.GetListValueByKey2=function(e,n,r){var i=[];return e&&0<e.length&&c(e).each(function(e,t){i.push(d.GetJsonValue(d.GetJsonValue(t,n),r))}),i},this.JsonArrUpdate=function(e,n,r){var i=this,a=[];return e&&0<e.length&&c(e).each(function(e,t){t[n]==r[n]?a.push(i.CombineJson(t,r)):a.push(t)}),a},this.JsonArrBatchUpdate=function(e,i,a,o,s){var l=[];return e&&0<e.length&&c(e).each(function(e,t){var n=t[i];if(-1<o.indexOf(n))for(var r in s)t[r][a]=s[r];l.push(t)}),l},this.JsonArrSingleUpdate=function(e,t,n,r,i,a){var o={},s={};if(e&&0<e.length)for(var l=0;l<e.length;l++){var h=e[l];if(r==h[t]){for(var u in s=JSON.parse(JSON.stringify(h)),i)h[u]||(h[u]={name:u,value:i[u]}),h[u][n]=i[u],u==T.AttrName.ENXFILE_ATTR_OBJNAME&&(h[T.AttrName.ENXFILE_ATTR_NAME][n]=i[u]);o=h;break}}return a&&a(s,o),o},this.JsonArrSingleUpdate2=function(e,t,n,r,i){if(e&&0<e.length)for(var a=0;a<e.length;a++){var o=e[a];if(r==o[t][n]){for(var s in i)o[s][n]=i[s];break}}},this.JsonArrDelete=function(e,n,r){var i=[];return e&&0<e.length&&c(e).each(function(e,t){t[n]!=r&&i.push(t)}),i},this.CombineJson=function(e,t){var n=e;if(t)for(var r in t)n[r]=t[r];return n},this.FilterListByValues=function(e,r,i){var a=[];return e&&0<e.length&&c(e).each(function(e,t){for(var n=0;n<i.length;n++)if(t[r]==i[n]){a.push(t);break}}),a},this.ExceptListByValues=function(e,i,a){var o=[];return e&&0<e.length&&c(e).each(function(e,t){for(var n=!1,r=0;r<a.length;r++)if(t[i]==a[r]){n=!0;break}n||o.push(t)}),o},this.CopyArr=function(e){var n=this,r=[];return e&&0<e.length&&c(e).each(function(e,t){r.push(n.strJsonToJsonObj(c.toJSON(t)))}),r},this.GetListValueByDoubleKey=function(e,r,i){var a=[];return e&&0<e.length&&c(e).each(function(e,t){var n=t[r]||{};a.push(n[i]||"")}),a},this.FilterArr=function(e,t,n){var r=[],i=t||"";if(e&&0<e.length)for(var a=0;a<e.length;a++){var o=e[a],s=!1;switch(n){case 0:s=0==o.indexOf(i);break;case 1:s=o.length-i.length==o.lastIndexOf(i);break;case 2:s=i==o}s&&r.push(o)}return r},this.StrArrToJsonList=function(e,t,n){var r=[];if(e&&0<e.length)for(var i=0;i<e.length;i++){var a=e[i],o={};o[t]=a,o[n]=a,r.push(o)}return r},this.Distinct=function(e){for(var t=[],n={},r=0;r<e.length;r++)n[e[r]]||(t.push(e[r]),n[e[r]]=1);return t},this.ArrDelete=function(e,n){var r=[];return e&&0<e.length&&c(e).each(function(e,t){t!=n&&r.push(t)}),r},this.ArrAdd=function(e,t){var n=[];return n.push(t),e&&0<e.length&&(0<=e.indexOf(t)||e.push(t),n=e),n},this.ArrJsonPaged=function(e,t,n,r){var i=[],a=n||0,o=t||0,s=a?a*o:0;if(e.length>s)for(var l=e.length-s,h=o<l?o:l,u=0;u<h;u++)i.push(e[s+u]);return i},this.JsonArrFilterByJson=function(e,o,s,t){var l=t||0,h=[];return e&&0<e.length&&c(e).each(function(e,t){var n=!0;for(var r in s){var i=d.GetJsonValue(t,r),a=s[r];if("object"==typeof i&&(i=d.GetJsonValue(i,o)),a instanceof Array&&0<a.length)n=n&&-1<a.indexOf(i);else switch(l){case 0:n=n&&0==i.indexOf(a);break;case 1:n=n&&i==a;break;case 2:n=n&&i.length-a.length==i.lastIndexOf(a);break;case 3:n=n&&0<=i.indexOf(a)}if(!n)break}n&&h.push(t)}),h},this.GetStrValue=function(e,t){return e[t]||""},this.GetJsonValue=function(e,t){return e[t]||{}},this.IsJsonObj=function(e){return"object"==typeof e&&"[object object]"==Object.prototype.toString.call(e).toLowerCase()&&!e.length}};return{enxHelper:e,enxConstField:T,jsonHelper:d}});