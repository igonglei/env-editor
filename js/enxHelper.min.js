var EnxHelper=new function(){this.GlobalVar=new function(){this.XMLTAG="<\\?xml.*\\?>",this.ExceptionNode="#text",this.IllegalTagEnd="/>",this.LawfulTagEnd="></parameter>",this.LinkTag="link>",this.LinkTagReplace="linkC>",this.UserDefineField=[],this.SpaceCount=2,this.FormatTpl=new function(){this.Paratemter="<parameter{0}/>",this.Link="<link>{0}</link>",this.CDATA="<![CDATA[{0}]]>"},this.ElemntIndex=new function(){this.Link=1,this.Ne=1,this.Board=1,this.SubBoard=1,this.Port=1,this.Tester=1,this.Dev=1,this.Atm=1,this.Eth=1,this.Sdh=1,this.Sftp=1,this.Agent=1,this.VM=1,this.Network=1},this.DeaultElemntIndex=new function(){this.Link=1,this.Ne=1,this.Board=1,this.SubBoard=1,this.Port=1,this.Tester=1,this.Dev=1,this.Atm=1,this.Eth=1,this.Sdh=1,this.Sftp=1,this.Agent=1,this.VM=1,this.Network=1}},this.Field={ID:"_id",BigType:"BigType",ParentGID:"ParentGID",IsTopDevice:"IsTopDevice",Name:"Name"},this.SpecialField={IP:"ip"},this.ModelType={Env:"Env",Ne:"Ne",Board:"Board",SubBoard:"SubBoard",Port:"Port",Link:"Link",Topolimit:"Topolimit",Tester:"Tester",Dev:"Dev",Atm:"Atm",Eth:"Eth",Sdh:"Sdh",Network:"Network",Sftp:"Sftp",Agent:"Agent",VM:"VM",Other:"Other"},this.ModelTypeOfTopDevice=[this.ModelType.Ne,this.ModelType.Atm,this.ModelType.Tester,this.ModelType.Dev,this.ModelType.Eth,this.ModelType.Sdh,this.ModelType.Network,this.ModelType.Sftp,this.ModelType.Agent],this.ResetMaxIndex=function(e,t){var n=t.match(new RegExp("0|[1-9]\\d*","gm"));n&&n.length>0&&this.GlobalVar.ElemntIndex[e]<=parseInt(n[n.length-1])&&(this.GlobalVar.ElemntIndex[e]=parseInt(n[n.length-1])+1)},this.PreDealEnxContent=function(e){return e.replace(new RegExp(this.GlobalVar.XMLTAG,"gm"),"").replace(new RegExp(EnxHelper.GlobalVar.IllegalTagEnd,"gm"),EnxHelper.GlobalVar.LawfulTagEnd).replace(new RegExp(EnxHelper.GlobalVar.LinkTag,"gm"),EnxHelper.GlobalVar.LinkTagReplace)},this.EnxToLstJson=function(e){var t=this;this.GlobalVar.ElemntIndex=this.GlobalVar.DeaultElemntIndex;var n=[];if(!e)return n;var r=this.PreDealEnxContent(e),i=$(r)[0],o={};o[EnxConstField.RootNodeAttr]=EnxHelper.GetNodeAttr(i);var a=EnxHelper.GetChildNode(i);return $.each(a,function(e,r){switch(r.tagName){case EnxConstField.NodeName.ENXFILE_NODE_PARAMETERS:var i=EnxHelper.ParameterNodeToJson(r);o=JsonHelper.CombineJson(i,o),n.push(o);break;case EnxConstField.NodeName.ENXFILE_NODE_DEVICES:var a=EnxHelper.GetChildNode(r);$(a).each(function(e,t){var r=EnxHelper.DeviceNodeToJson(t,o,!0);n=n.concat(r)});break;case EnxConstField.NodeName.ENXFILE_NODE_LINKS:var l=EnxHelper.GetChildNode(r);$(l).each(function(e,r){var i=EnxHelper.LinkNodeToJson(r);i&&i.objname&&i.objname.value&&(i[EnxHelper.Field.ParentGID]=JsonHelper.GetStrValue(o,EnxHelper.Field.ID),n.push(i),t.ResetMaxIndex(EnxHelper.ModelType.Link,i.objname.value))});break;case EnxConstField.NodeName.ENXFILE_NODE_TOPOLIMIT:var s={};s[EnxHelper.Field.BigType]=EnxHelper.ModelType.Topolimit,s[EnxHelper.Field.ParentGID]=JsonHelper.GetStrValue(o,EnxHelper.Field.ID),s[EnxHelper.Field.Name]=EnxHelper.MatchTopLimit($.trim(r.innerHTML)),s[EnxHelper.Field.ID]=EnxHelper.CreateNewGuid(),n.push(s)}}),n},this.LstJsonToEnx=function(e){if(!e||0==e.length)return"";var t=$(EnxConstField.XMLTAG.LOGIC_ENVIRONMENT),n=JsonHelper.GetJsonByKey(e,EnxHelper.Field.BigType,EnxHelper.ModelType.Env);JsonHelper.IsJsonObj(n)&&!JsonHelper.IsEmptyJson(n)&&n||(n=EnxHelper.ParameterNodeToJson(null));var r=n[EnxConstField.RootNodeAttr];for(var i in r)t.attr(i,JsonHelper.GetStrValue(r,i));var o=$(EnxConstField.XMLTAG.PARAMETERSTAG);o[0].innerText=EnxHelper.XmlGetParameter(n,!0),t.append(o),EnxHelper.XMLJsonToNode(n,t,e);var a=$(EnxConstField.XMLTAG.LINKS),l=JsonHelper.FilterListByValues(e,EnxHelper.Field.BigType,[EnxHelper.ModelType.Link]),s="";$.each(l,function(e,t){s+=EnxHelper.Format(EnxHelper.GlobalVar.FormatTpl.Link,EnxHelper.XmlGetParameter(t))}),a[0].innerText=s,t.append(a);var E=JsonHelper.GetJsonByKey(e,EnxHelper.Field.BigType,EnxHelper.ModelType.Topolimit),h=$(EnxConstField.XMLTAG.TOPOLIMIT);return h[0].innerText=EnxHelper.Format(EnxHelper.GlobalVar.FormatTpl.CDATA,E[EnxHelper.Field.Name]||""),t.append(h),t[0].outerHTML},this.XmlGetParameter=function(e,t){0==this.GlobalVar.UserDefineField.length&&(this.GlobalVar.UserDefineField=JsonHelper.GetJsonAllValue(EnxHelper.Field),this.GlobalVar.UserDefineField.push(EnxConstField.RootNodeAttr));var n="";for(var r in e)if(this.GlobalVar.UserDefineField.indexOf(r)<0){var i=e[r],o="";for(var a in i)o+=" "+a+'="'+this.DealSpecialSingal(i[a])+'"';n+=EnxHelper.Format(EnxHelper.GlobalVar.FormatTpl.Paratemter,o)}return n},this.DealSpecialSingal=function(e){return void 0!=e&&null!=e&&e?(e.indexOf('"')>-1&&(e=e.replace(new RegExp('"',"gm"),"★")),e.indexOf("&")>-1&&(e=e.replace(new RegExp("&","gm"),"♣")),e.indexOf("<")>-1&&(e=e.replace(new RegExp("<","gm"),"◀")),e.indexOf(">")>-1&&(e=e.replace(new RegExp(">","gm"),"▶")),e):e},this.XMLJsonToNode=function(e,t,n){var r=JsonHelper.GetStrValue(e,EnxHelper.Field.ID),i=[];if((i=e.BigType==EnxHelper.ModelType.Env?JsonHelper.FilterListByValues(n,EnxHelper.Field.IsTopDevice,[EnxConstField.BoolStr.Yes]):JsonHelper.FilterListByValues(n,EnxHelper.Field.ParentGID,[r]))&&i.length>0){var o=$(EnxConstField.XMLTAG.DEVICES);$.each(i,function(e,t){var r=$(EnxConstField.XMLTAG.DEVICE),i=$(EnxConstField.XMLTAG.PARAMETERSTAG),a=EnxHelper.XmlGetParameter(t);i[0].innerText=a,r.append(i),EnxHelper.XMLJsonToNode(t,r,n),o.append(r)}),t.append(o)}},this.GetUserDefineField=function(){},this.LinkNodeToJson=function(e){var t={},n=EnxHelper.GetChildNode(e);return $.each(n,function(e,n){var r=$(n).attr(EnxConstField.AttrName.ENXFILE_ATTR_NAME);r&&(t[EnxHelper.Field.BigType]=EnxHelper.ModelType.Link,t[r]=EnxHelper.GetNodeAttr(n))}),this.NodeAttachFieldId(t),t},this.NodeAttachFieldId=function(e){var t=JsonHelper.GetJsonValue(e,EnxConstField.AttrName.ENXFILE_ATTR_GUID),n=JsonHelper.GetStrValue(t,EnxConstField.AttrName.ENXFILE_ATTR_VALUE),r=n||EnxHelper.CreateNewGuid();e[EnxHelper.Field.ID]=r},this.ParameterNodeToJson=function(e){var t={};t[EnxHelper.Field.BigType]=EnxHelper.ModelType.Env;var n=EnxHelper.GetChildNode(e);return $.each(n,function(e,n){var r=$(n).attr(EnxConstField.AttrName.ENXFILE_ATTR_NAME);t[r]=EnxHelper.GetNodeAttr(n)}),this.NodeAttachFieldId(t),t},this.DeviceNodeToJson=function(e,t,n){var r=[],i={};i[EnxHelper.Field.ParentGID]=t[EnxHelper.Field.ID]||"",i[EnxHelper.Field.IsTopDevice]=n?EnxConstField.BoolStr.Yes:EnxConstField.BoolStr.No;var o=[],a=EnxHelper.GetChildNode(e);return $.each(a,function(e,t){var n=t.tagName,r=EnxHelper.GetChildNode(t);switch(n){case EnxConstField.NodeName.ENXFILE_NODE_DEVICES:$.each(r,function(e,t){var n=EnxHelper.DeviceNodeToJson(t,i);o=o.concat(n)});break;case EnxConstField.NodeName.ENXFILE_NODE_PARAMETERS:if($.each(r,function(e,t){var n=$(t).attr(EnxConstField.AttrName.ENXFILE_ATTR_NAME);if(n==EnxConstField.AttrName.ENXFILE_ATTR_CLASS){var r=$(t).attr(EnxConstField.AttrName.ENXFILE_ATTR_VALUE);i[EnxHelper.Field.BigType]=EnxHelper.GetDeviceType(r)}i[n]=EnxHelper.GetNodeAttr(t)}),"ne1_board1_subboard1_port1"==i.objname.value);EnxHelper.NodeAttachFieldId(i)}}),i.objname&&(this.ResetMaxIndex(i[EnxHelper.Field.BigType],i.objname.value),r.push(i),r=r.concat(o)),r},this.MatchTopLimit=function(e){return e.replace("\x3c!--[CDATA[","").replace("]]--\x3e","")},this.GetDeviceType=function(e){var t="";switch(e){case EnxConstField.SpecialName.ENXFILE_SPECIAL_TESTERTYPE:t=EnxHelper.ModelType.Tester;break;case EnxConstField.SpecialName.ENXFILE_SPECIAL_DEVTYPE:t=EnxHelper.ModelType.Dev;break;case EnxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEATM:t=EnxHelper.ModelType.Atm;break;case EnxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPEETH:t=EnxHelper.ModelType.Eth;break;case EnxConstField.SpecialName.ENXFILE_SPECIAL_UNKOWNTYPESDH:t=EnxHelper.ModelType.Sdh;break;default:t=e}return t},this.GetNodeAttr=function(e){var t=e.attributes,n=$.makeArray(t);n.sort(function(e,t){return EnxConstField.AttrDic[e.name]-EnxConstField.AttrDic[t.name]});var r={};return $.each(n,function(e,t){r[t.name]=t.value}),r},this.CreateNewGuid=function(){for(var e="",t=1;t<=32;t++)e+=Math.floor(16*Math.random()).toString(16),8!=t&&12!=t&&16!=t&&20!=t||(e+="-");return e},this.Format=function(e,t){return 1==arguments.length?function(){var t=$.makeArray(arguments);return t.unshift(e),EnxHelper.Format.apply(this,t)}:(arguments.length>2&&t.constructor!=Array&&(t=$.makeArray(arguments).slice(1)),t.constructor!=Array&&(t=[t]),$.each(t,function(t,n){e=e.replace(new RegExp("\\{"+t+"\\}","g"),n)}),e)},this.GetChildNode=function(e){var t=[];return e&&e.childNodes&&$.each(e.childNodes,function(e,n){n.nodeName!=EnxHelper.GlobalVar.ExceptionNode&&t.push(n)}),t},this.GetQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},this.AttrParameter=function(e,t){var n={};return n[EnxConstField.AttrName.ENXFILE_ATTR_NAME]=e,n[EnxConstField.AttrName.ENXFILE_ATTR_VALUE]=t||"",n}},EnxConstField=new function(){this.RootNodeAttr="rootNodeAttr",this.NodeName={ENXFILE_NODE_DEVICES:"DEVICES",ENXFILE_NODE_LINKS:"LINKS",ENXFILE_NODE_TOPOLIMIT:"TOPOLIMIT",ENXFILE_NODE_LINK:"LINK",ENXFILE_NODE_DEVICE:"DEVICE",ENXFILE_NODE_PARAMETER:"PARAMETER",ENXFILE_NODE_PARAMETERS:"PARAMETERS"},this.AttrName={ENXFILE_ATTR_NAME:"name",ENXFILE_ATTR_OBJNAME:"objname",ENXFILE_ATTR_VALUE:"value",ENXFILE_ATTR_GROUPSHOW:"groupshow",ENXFILE_ATTR_CLASS:"class",ENXFILE_ATTR_SOURCETOPDEVICENAME:"sourcetopdevicename",ENXFILE_ATTR_TARGETTOPDEVICENAME:"targettopdevicename",ENXFILE_ATTR_SOURCEDEVICEID:"sourcedeviceid",ENXFILE_ATTR_TARGETDEVICEID:"targetdeviceid",ENXFILE_ATTR_GUID:"guid",ENXFILE_ATTR_ROLER:"roler",ENXFILE_ATTR_CLASS:"class",ENXFILE_ATTR_FULLCLASS:"fullclass",ENXFILE_ATTR_POSITION:"position",ENXFILE_ATTR_INTERFACE:"interface"},this.SpecialName={ENXFILE_SPECIAL_TESTERTYPE:"Instru::Tester",ENXFILE_SPECIAL_DEVTYPE:"Instru::Dev",ENXFILE_SPECIAL_UNKOWNTYPEETH:"Instru::Eth::Chassis",ENXFILE_SPECIAL_UNKOWNTYPEATM:"Instru::Atm::Chassis",ENXFILE_SPECIAL_UNKOWNTYPESDH:"Instru::Sdh",ENXFILE_SPECIAL_UNKOWNTYPECONNECT:"Connect"},this.XMLTAG=new function(){this.LOGIC_ENVIRONMENT="<logic_environment></logic_environment>",this.PARAMETERSTAG="<parameters></parameters>",this.DEVICES="<devices></devices>",this.LINKS="<links></links>",this.TOPOLIMIT="<topolimit></topolimit>",this.DEVICE="<device></device>",this.LINK="<link></link>",this.PARAMETER="<parameter/>"},this.AttrDic={name:10,value:11,notnull:12,visible:13,readonly:14,description:15,version:16},this.BoolStr={Yes:"yes",No:"no"},this.NameSeparate="_",this.NamePoint="to",this.ClassSeparate="::"},JsonHelper=new function(){this.SetJsonByKey=function(e,t,n,r,i){var o={};if(e&&e.length>0)for(var a=0;a<e.length;a++){var l=e[a];this.IsContainKey(r,l[t])?l[n]=i[r[l[t]].toString()]:l[n]=i.default}return o},this.GetJsonByKey=function(e,t,n){var r={};if(e&&e.length>0)for(var i=0;i<e.length;i++){var o=e[i];if(o[t]==n){r=o;break}}return r},this.GetJsonByKeyAndSecondKey=function(e,t,n,r){var i={};if(e&&e.length>0)for(var o=0;o<e.length;o++){var a=e[o];if(a[t][n]==r){i=a;break}}return i},this.GetJsonKeyList=function(e){var t=[];for(var n in e)t.push(e[n]);return t},this.ParseJsonToArr=function(e){var t=[];for(var n in e){var r={Name:n,Value:e[n]};t.push(r)}return t},this.GetJsonAllValue=function(e){var t=[];for(var n in e)t.push(e[n]);return t},this.GetJsonAllKey=function(e){var t=[];for(var n in e)t.push(n);return t},this.CopyJson=function(e){var t={};if(e){var n=$.toJSON(e);t=this.strJsonToJsonObj(n)}return t},this.IsEmptyJson=function(e){var t=!0;if(e)for(var n in e)if(!(t=!1))break;return t},this.IsContainKey=function(e,t){var n=!1;if(e)for(var r in e)if(r==t){n=!0;break}return n},this.ParseArrStrToArrJson=function(e){var t=[];return e&&e.length>0&&$(e).each(function(e,n){t.push(JSON.parse(n))}),t},this.IsArrStrContain=function(e,t){var n=!1;if(e&&e.length>0)for(var r=0;r<e.length;r++)if(e[r]==t){n=!0;break}return n},this.strJsonToJsonObj=function(e){return new Function("return "+e)()},this.GetListValueByKey=function(e,t){var n=[];return e&&e.length>0&&$(e).each(function(e,r){n.push(r[t])}),n},this.GetListValueByKey2=function(e,t,n){var r=[];return e&&e.length>0&&$(e).each(function(e,i){r.push(JsonHelper.GetJsonValue(JsonHelper.GetJsonValue(i,t),n))}),r},this.JsonArrUpdate=function(e,t,n){var r=this,i=[];return e&&e.length>0&&$(e).each(function(e,o){o[t]==n[t]?i.push(r.CombineJson(o,n)):i.push(o)}),i},this.JsonArrBatchUpdate=function(e,t,n,r,i){var o=[];return e&&e.length>0&&$(e).each(function(e,a){var l=a[t];if(r.indexOf(l)>-1)for(var s in i)a[s][n]=i[s];o.push(a)}),o},this.JsonArrSingleUpdate=function(e,t,n,r,i,o){var a={},l={};if(e&&e.length>0)for(var s=0;s<e.length;s++){var E=e[s];if(r==E[t]){l=JSON.parse(JSON.stringify(E));for(var h in i)E[h]||(E[h]={name:h,value:i[h]}),E[h][n]=i[h],h==EnxConstField.AttrName.ENXFILE_ATTR_OBJNAME&&(E[EnxConstField.AttrName.ENXFILE_ATTR_NAME][n]=i[h]);a=E;break}}return o&&o(l,a),a},this.JsonArrSingleUpdate2=function(e,t,n,r,i){if(e&&e.length>0)for(var o=0;o<e.length;o++){var a=e[o];if(r==a[t][n]){for(var l in i)a[l][n]=i[l];break}}},this.JsonArrDelete=function(e,t,n){var r=[];return e&&e.length>0&&$(e).each(function(e,i){i[t]!=n&&r.push(i)}),r},this.CombineJson=function(e,t){var n=e;if(t)for(var r in t)n[r]=t[r];return n},this.FilterListByValues=function(e,t,n){var r=[];return e&&e.length>0&&$(e).each(function(e,i){for(var o=0;o<n.length;o++)if(i[t]==n[o]){r.push(i);break}}),r},this.ExceptListByValues=function(e,t,n){var r=[];return e&&e.length>0&&$(e).each(function(e,i){for(var o=!1,a=0;a<n.length;a++)if(i[t]==n[a]){o=!0;break}o||r.push(i)}),r},this.CopyArr=function(e){var t=this,n=[];return e&&e.length>0&&$(e).each(function(e,r){n.push(t.strJsonToJsonObj($.toJSON(r)))}),n},this.GetListValueByDoubleKey=function(e,t,n){var r=[];return e&&e.length>0&&$(e).each(function(e,i){var o=i[t]||{};r.push(o[n]||"")}),r},this.FilterArr=function(e,t,n){var r=[],i=t||"";if(e&&e.length>0)for(var o=0;o<e.length;o++){var a=e[o],l=!1;switch(n){case 0:l=0==a.indexOf(i);break;case 1:l=a.length-i.length==a.lastIndexOf(i);break;case 2:l=i==a}l&&r.push(a)}return r},this.StrArrToJsonList=function(e,t,n){var r=[];if(e&&e.length>0)for(var i=0;i<e.length;i++){var o=e[i],a={};a[t]=o,a[n]=o,r.push(a)}return r},this.Distinct=function(e){for(var t=[],n={},r=0;r<e.length;r++)n[e[r]]||(t.push(e[r]),n[e[r]]=1);return t},this.ArrDelete=function(e,t){var n=[];return e&&e.length>0&&$(e).each(function(e,r){r!=t&&n.push(r)}),n},this.ArrAdd=function(e,t){var n=[];return n.push(t),e&&e.length>0&&(e.indexOf(t)>=0?n=e:(e.push(t),n=e)),n},this.ArrJsonPaged=function(e,t,n,r){var i=[],o=n||0,a=t||0,l=o?o*a:0;if(e.length>l)for(var s=e.length-l,E=s>a?a:s,h=0;h<E;h++)i.push(e[l+h]);return i},this.JsonArrFilterByJson=function(e,t,n,r){var i=r||0,o=[];return e&&e.length>0&&$(e).each(function(e,r){var a=!0;for(var l in n){var s=JsonHelper.GetJsonValue(r,l),E=n[l];if("object"==typeof s&&(s=JsonHelper.GetJsonValue(s,t)),E instanceof Array&&E.length>0)a=a&&E.indexOf(s)>-1;else switch(i){case 0:a=a&&0==s.indexOf(E);break;case 1:a=a&&s==E;break;case 2:a=a&&s.length-E.length==s.lastIndexOf(E);break;case 3:a=a&&s.indexOf(E)>=0}if(!a)break}a&&o.push(r)}),o},this.GetStrValue=function(e,t){return e[t]||""},this.GetJsonValue=function(e,t){return e[t]||{}},this.IsJsonObj=function(e){return"object"==typeof e&&"[object object]"==Object.prototype.toString.call(e).toLowerCase()&&!e.length}};